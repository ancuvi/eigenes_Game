<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a1a">
    <title>Pixel Purgatory</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
</head>
<body>
    <div id="transition-overlay"></div>
    
    <!-- New Screens -->
    <div id="intro-screen" class="fullscreen-overlay">
        <div class="intro-text">
            Bitte Ger√§t ins Querformat drehen.<br>
            Please rotate your device.
        </div>
    </div>
    
    <div id="loading-screen" class="fullscreen-overlay hidden"></div>

    <div id="game-container">
        <!-- Start Screen -->
        <div id="start-screen" class="hidden">
            <div class="start-card">
                <div class="title-block">
                    <p class="eyebrow">Top-Down Roguelite</p>
                    <h1 class="game-title">Pixel Purgatory</h1>
                    <p class="tagline">Melt demons, collect loot, keep the run alive.</p>
                </div>
                <div class="menu-grid">
                    <button id="inventory-btn" class="menu-btn secondary">Inventory &amp; Merge</button>
                    <button id="stage-select-btn" class="menu-btn secondary">Select Stage</button>
                    <button id="start-upgrade-btn" class="menu-btn secondary">Upgrades</button>
                    <button id="start-btn" class="menu-btn primary">Start Game</button>
                </div>
            </div>
        </div>

        <!-- Stage Select Modal -->
        <div id="stage-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Select Stage</h2>
                    <button class="close-modal" data-target="stage-modal">√ó</button>
                </div>
                <div id="stage-list">
                    <!-- Generated via JS -->
                </div>
            </div>
        </div>

        <!-- Stage Info Modal -->
        <div id="stage-info-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="stage-info-title">Stage Info</h2>
                    <button class="close-modal" data-target="stage-info-modal">√ó</button>
                </div>
                <div id="stage-info-content" class="info-content">
                    <!-- Dynamic Content -->
                </div>
            </div>
        </div>

        <!-- Patch Notes Modal -->
        <div id="patch-notes-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Latest Updates</h2>
                    <button class="close-modal" data-target="patch-notes-modal">√ó</button>
                </div>
                <div class="patch-notes-body">
                    <div class="patch-entry">
                        <div class="patch-date">03.12.2025</div>
                        <ul class="patch-list">
                            <li>üß© <strong>Sprites auf 64√ó64 vereinheitlicht:</strong> klarere Kollisionen & knackigere Pixelkanten.</li>
                            <li>üéõÔ∏è <strong>Startscreen neu aufgebaut:</strong> Button-Grid, Tagline und bessere Lesbarkeit auf allen Ger√§ten.</li>
                            <li>üßæ <strong>Patch-Notizen mit Datum:</strong> Chronologisch scrollen und √§ltere Updates nachlesen.</li>
                        </ul>
                    </div>

                    <div class="patch-entry">
                        <div class="patch-date">02.12.2025</div>
                        <ul class="patch-list">
                            <li>ü§ñ <strong>Neue Gegner-KI:</strong> Isaac-Style Physics! Kein Teleport mehr, sondern echter R√ºcksto√ü.</li>
                            <li>üëæ <strong>Gegner-Typen:</strong> Glibber (rutscht), Bull (st√ºrmt), Spucker (schie√üt) & co.</li>
                            <li>‚ú® <strong>Smooth Transitions:</strong> Butterweiche √úberg√§nge zwischen Screens.</li>
                            <li>üì± <strong>Intro & Loading:</strong> Neuer Start-Ablauf.</li>
                            <li>‚ÑπÔ∏è <strong>Stage Info:</strong> Klicke auf das "i" bei der Stage-Wahl f√ºr Drop-Chancen.</li>
                        </ul>
                    </div>

                    <button class="menu-btn primary close-modal" data-target="patch-notes-modal">Alles klar!</button>
                </div>
            </div>
        </div>

        <!-- Inventory Modal -->
        <div id="inventory-modal" class="modal hidden">
            <div class="modal-content large">
                <div class="modal-header">
                    <h2>Inventory & Merge</h2>
                    <button class="close-modal" data-target="inventory-modal">√ó</button>
                </div>
                <div id="equipment-panel">
                    <div class="equip-slot" data-slot="weapon">
                        <span class="slot-label">Weapon</span>
                        <div class="slot-content"></div>
                    </div>
                    <div class="equip-slot" data-slot="armor">
                        <span class="slot-label">Armor</span>
                        <div class="slot-content"></div>
                    </div>
                    <div class="equip-slot" data-slot="helmet">
                        <span class="slot-label">Helmet</span>
                        <div class="slot-content"></div>
                    </div>
                    <div class="equip-slot" data-slot="accessory">
                        <span class="slot-label">Accessory</span>
                        <div class="slot-content"></div>
                    </div>
                </div>
                <div class="inventory-layout">
                    <div id="inventory-grid">
                        <!-- Items generated here -->
                    </div>
                    <div id="item-details-panel">
                        <div id="selected-item-info">Select an item...</div>
                        <div class="item-actions">
                            <button id="action-btn" disabled>Equip</button>
                            <button id="merge-btn" disabled>Merge (3 required)</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Header Area (Stats + Buttons) -->
        <div id="ui-header">
            <div class="header-left">
                <button id="log-toggle">Log</button>
                <button id="map-toggle">Map</button>
                <button id="stats-toggle">Stats</button>
                <button id="bag-btn">Bag</button>
                <button id="auto-btn">Auto: OFF</button>
            </div>

            <div id="stats-panel">
                <div class="stat-item">LVL: <span id="stat-level">1</span></div>
                <div class="stat-item">HP: <span id="stat-hp">100</span>/<span id="stat-max-hp">100</span></div>
                <div class="stat-item">GOLD: <span id="stat-gold">0</span></div>
            </div>
        </div>

        <!-- Spielbereich (Canvas) - F√ºllt den Rest -->
        <div id="game-area">
            <canvas id="gameCanvas"></canvas>
        </div>

        <!-- Upgrade Panel (Bottom) -->
        <div id="upgrade-panel">
            <div id="mini-stats-row">
                <div class="mini-stat" title="Attack"><span class="icon">‚öîÔ∏è</span> <span id="ms-atk">0</span></div>
                <div class="mini-stat" title="Health"><span class="icon">‚ù§Ô∏è</span> <span id="ms-hp">0</span></div>
                <div class="mini-stat" title="Defense"><span class="icon">üõ°Ô∏è</span> <span id="ms-def">0%</span></div>
                <div class="mini-stat" title="Attack Speed"><span class="icon">‚ö°</span> <span id="ms-spd">0/s</span></div>
            </div>
            <div class="upgrade-grid">
                <!-- Buttons will be generated by JS -->
                <button class="upgrade-btn" data-type="attack">
                    <span class="upg-name">Attack</span>
                    <span class="upg-lvl">Lvl 0</span>
                    <span class="upg-cost">50 G</span>
                </button>
                <button class="upgrade-btn" data-type="hp">
                    <span class="upg-name">HP</span>
                    <span class="upg-lvl">Lvl 0</span>
                    <span class="upg-cost">50 G</span>
                </button>
                <button class="upgrade-btn" data-type="attackSpeed">
                    <span class="upg-name">Atk Speed</span>
                    <span class="upg-lvl">Lvl 0</span>
                    <span class="upg-cost">100 G</span>
                </button>
                <button class="upgrade-btn" data-type="regen">
                    <span class="upg-name">Regen</span>
                    <span class="upg-lvl">Lvl 0</span>
                    <span class="upg-cost">100 G</span>
                </button>
            </div>
        </div>

        <!-- Log Modal -->
        <div id="log-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Game Log</h2>
                    <button class="close-modal" data-target="log-modal">√ó</button>
                </div>
                <div id="log-content">
                    <div>Willkommen in der Pixel-Welt!</div>
                </div>
            </div>
        </div>
        
        <!-- Start Screen Upgrade Modal -->
        <div id="start-upgrade-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Permanent Upgrades</h2>
                    <button class="close-modal" data-target="start-upgrade-modal">√ó</button>
                </div>
                <div class="modal-body">
                    <div style="text-align:center; margin-bottom:10px;">GOLD: <span id="start-gold-display">0</span></div>
                    <div id="start-upgrade-grid" class="upgrade-grid">
                        <!-- Same structure as in-game -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Map Overlay -->
        <div id="map-overlay">
            <div id="map-dialog">
                <div id="map-header">
                    <span>Weltkarte</span>
                    <button id="map-close">√ó</button>
                </div>
                <canvas id="map-canvas" width="420" height="420"></canvas>
                <div id="map-legend">
                    <span class="legend visited"></span> Erkundet
                    <span class="legend current"></span> Aktuelle Position
                </div>
            </div>
        </div>

        <!-- Stats Overlay -->
        <div id="stats-overlay">
            <div id="stats-dialog">
                <div id="stats-header">
                    <span>Spieler-Stats</span>
                    <button id="stats-close">√ó</button>
                </div>
                <div id="stats-content">
                    <div class="stats-section">
                        <div class="section-title">Allgemein</div>
                        <div class="stat-row"><span>Level</span><span id="stat-level-overlay">1</span></div>
                        <div class="stat-row"><span>HP</span><span><span id="stat-hp-overlay">100</span>/<span id="stat-maxhp-overlay">100</span></span></div>
                        <div class="stat-row"><span>Regen</span><span id="stat-regen-overlay">1/s</span></div>
                        <div class="stat-row"><span>Gold</span><span id="stat-gold-overlay">0</span></div>
                        <div class="stat-row"><span>EXP</span><span><span id="stat-exp-overlay">0</span>/<span id="stat-exp-max-overlay">100</span></span></div>
                        <div class="stat-row"><span>Move Speed</span><span id="stat-ms-overlay">200</span></div>
                    </div>

                    <div class="stats-section">
                        <div class="section-title">Offensive</div>
                        <div class="stat-row"><span>Angriff</span><span id="stat-attack">10</span></div>
                        <div class="stat-row"><span>Angriffsrate</span><span id="stat-attackrate">1/s</span></div>
                        <div class="stat-row"><span>Angriffs-CD</span><span id="stat-attackcd">1000 ms</span></div>
                        <div class="stat-row"><span>Krit. Chance</span><span id="stat-crit-chance">5%</span></div>
                        <div class="stat-row"><span>Krit. Multiplikator</span><span id="stat-crit-mult">150%</span></div>
                        <div class="stat-row"><span>Angriffsreichweite</span><span id="stat-range">60</span></div>
                        <div class="stat-row"><span>Reichw. Schadensmult</span><span id="stat-range-mult">0%</span></div>
                        <div class="stat-row"><span>Verlangsamungschance</span><span id="stat-slow-chance">0%</span></div>
                        <div class="stat-row"><span>Verlangsamungsst√§rke</span><span id="stat-slow-strength">0%</span></div>
                        <div class="stat-row"><span>Trefferrate</span><span id="stat-hit-rate">0%</span></div>
                        <div class="stat-row"><span>Doppelangriffchance</span><span id="stat-double-chance">0%</span></div>
                        <div class="stat-row"><span>Doppelangriff-Schaden</span><span id="stat-double-mult">0%</span></div>
                        <div class="stat-row"><span>Mehrfach-Angriffchance</span><span id="stat-multistrike-chance">0%</span></div>
                        <div class="stat-row"><span>Mehrfachziel-Anzahl</span><span id="stat-multistrike-targets">0</span></div>
                        <div class="stat-row"><span>Spritzer-Chance</span><span id="stat-splash-chance">0%</span></div>
                        <div class="stat-row"><span>Spritzer-Schaden</span><span id="stat-splash-mult">0%</span></div>
                        <div class="stat-row"><span>Spritzer-Ziele</span><span id="stat-splash-targets">0</span></div>
                        <div class="stat-row"><span>Bet√§ubungschance</span><span id="stat-stun-chance">0%</span></div>
                        <div class="stat-row"><span>Bet√§ubungszeit</span><span id="stat-stun-duration">0s</span></div>
                        <div class="stat-row"><span>R√ºcksto√üchance</span><span id="stat-knockback-chance">0%</span></div>
                        <div class="stat-row"><span>T√∂dlicher Treffer</span><span id="stat-lethal">0%</span></div>
                        <div class="stat-row"><span>F√§higkeiten-Kritchance</span><span id="stat-ability-crit">0%</span></div>
                        <div class="stat-row"><span>F√§higkeiten-Kritmult</span><span id="stat-ability-crit-mult">0%</span></div>
                        <div class="stat-row"><span>Schwere Wunde</span><span id="stat-heavy-wound">0%</span></div>
                    </div>

                    <div class="stats-section">
                        <div class="section-title">Defensive</div>
                        <div class="stat-row"><span>Schadensresistenz</span><span id="stat-dmg-resist">0%</span></div>
                        <div class="stat-row"><span>Ausweichchance</span><span id="stat-dodge">0%</span></div>
                        <div class="stat-row"><span>Schadensr√ºckgabe</span><span id="stat-dmg-return">0%</span></div>
                        <div class="stat-row"><span>Schild-HP</span><span id="stat-shield-hp">0</span></div>
                        <div class="stat-row"><span>Schild-CD</span><span id="stat-shield-cd">0s</span></div>
                        <div class="stat-row"><span>Statusresistenz</span><span id="stat-status-resist">0%</span></div>
                        <div class="stat-row"><span>Lebensraub</span><span id="stat-lifesteal">0%</span></div>
                        <div class="stat-row"><span>Kritischer Widerstand</span><span id="stat-crit-resist">0</span></div>
                        <div class="stat-row"><span>Zusatzzschadens-Widerstand</span><span id="stat-additional-resist">0%</span></div>
                        <div class="stat-row"><span>Schild-Schadensreduktion</span><span id="stat-shield-dmg-reduction">0%</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>
